#Мастер настройки для бота в Teamtalk.
#Написан по собственной инициативе: для удобной и быстрой настройки приложения.
#Внимание: скрипт создаёт systemd сервис файл внутри пользователя. Это является более эргономично и безопасно.
#Теперь скрипт вставит косую черту в конец обсалютного пути. Работает это с указанием бинарной папки с программой.
#мастер направит пользователя в домашнюю папку автоматически, по этому в некоторых случаях можно использовать относительные пути. Например, при имени файла конфигурации: просто укажите имя файла без расширения. Кеш бота будет для удобства привязан к имени файла конфигурации и будет с расширением .dat. По этому лучше указывать имя файла с настройками под определённый чат.
cd
read -e -p "enter the path of the configuration file. without extension .json" c
read -e -p "Enter full  path of binary bot folder" folder
PS3="select the language of the bot."
select leng in en ru tr
do
echo "language : $leng"
break
done
PS3="enable or desable send_channel_messages. True enable or false disable."
select cm in true false
do
echo "send_channel_messages: $cm"
break
done
read -e -p "after how many seconds should the bot delete its uploaded file in the channel?" df
read -e -p "enter the default volume. It is not recommended to set 100" v
read -e -p "enter the maximum volume. The maximum can be set to 100" mv
read -e -p "enter host adress" adress
read -e -p "enter tcp port" tcp
read -e -p "Enter udp port" udp
read -e -p "enter nick name" nick
read -e -p "enter gender for bot" g
read -e -p "enter status msg for bot" smsg
read -e -p "enter user name for bot" user
read -s -e -p "enter password for user" password
read -e -p "enter the path to the channel where the bot should connect. For example, /music or /music / bot/" tt
read -s -e -p "enter password of channel. if the channel is without a password, then just press enter." ttp
read -e -p "Here you can insert your page's token on vk.com. If for some reason you have not created a token, just press  enter." token
PS3="select default media service"
select sv in vk yt
do
echo "default service: $sv"
break
done
PS3="enable or disable Vk service true is enabled, and false is disabled"
select VkStats in true false
do
echo "Using the Vk service is set to $VkStatus"
break
done
PS3="Using the Yt service: true enabled, false disabled"
select YtStats in true false
do
echo "using of the Yt service is set to $YtStats"
break
done
read -e -p "Enter the full path to the log file. It is also unnecessary to write the file name. It will be written automatically. Else it iz apsalute path too enter / in end " log
read -e -p "Enter name of systemd unit file.service insert automaticly" service
exec 1> $c.json
echo "{
    \"general\": {
        \"language\": \"$leng\",
        \"send_channel_messages\": $cm,
        \"cache_file_name\": \"$c-Cash.dat\",
        \"blocked_commands\": [],
        \"delete_uploaded_files_after\": $df,
        \"time_format\": \"%H:%M\",
    },
    \"sound_devices\": {
        \"output_device\": 0,
        \"input_device\": 0
    },
    \"player\": {
        \"default_volume\": $v,
        \"max_volume\": $mv,
        \"volume_fading\": true,
        \"volume_fading_interval\": 0.025,
        \"seek_step\": 5,
    },
    \"teamtalk\": {
        \"hostname\": \"$adress\",
        \"tcp_port\": $tcp,
        \"udp_port\": $udp,
        \"encrypted\": false,
        \"nickname\": \"$nick\",
        \"status\": \"$smsg\",
        \"gender\": \"$g\",
        \"username\": \"$user\",
        \"password\": \"$password\",
        \"channel\": \"$tt\",
        \"channel_password\": \"$ttp\",
        \"license_name\": \"\",
        \"license_key\": \"\",
        \"reconnection_attempts\": -1,
        \"reconnection_timeout\": 10,
        \"users\": {
            \"admins\": [
                \"admin\"
            ],
            \"banned_users\": []
        }
    },
\"services\": {
        "default_service": "$sv",
        \"vk\": {
            \"enabled\": $VkStats,
            \"token\": "$token"
        },
        \"yt\": {
            \"enabled\": $YtStats
        }
    },
    \"logger\": {
        \"log\": true,
        \"level\": \"INFO\",
        \"format\": \"%(levelname)s [%(asctime)s]: %(message)s in %(threadName)s file: %(filename)s line %(lineno)d function %(funcName)s\",
        \"mode\": \"FILE\",
        \"file_name\": \"$log/TTMediaBot.log\",
        \"max_file_size\": 0,
        \"backup_count\": 0
    }
}" >&1
exec 3> .config/systemd/user/$service.service
echo "[Unit]
Description=TTMediaBot systemd unit file. Generaitid  by BashScriptPakFFW
After=network.target

[Service]
ExecStart=$folder/TTMediaBot.sh -c $c.json

[Install]
WantedBy=default.target" >&3
systemctl --user daemon-reload
systemctl --user enable $service
systemctl --user start $service